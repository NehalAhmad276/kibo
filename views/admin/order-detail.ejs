<h2 class="fw-bold mb-4">Order Details</h2>

<div class="row">

  <!-- ORDER INFO -->
  <div class="col-md-6">
    <div class="card shadow-sm border-0 p-4 mb-4">
      <h5 class="fw-bold mb-3">Order Info</h5>

      <p><strong>Order ID:</strong> <%= order._id %></p>
      <p><strong>Status:</strong> <%= order.status %></p>
      <p><strong>Total:</strong> ₹<%= order.totalAmount %></p>
      <p><strong>Date:</strong> <%= order.createdAt.toDateString() %></p>
    </div>

    <!-- USER INFO -->
    <div class="card shadow-sm border-0 p-4">
      <h5 class="fw-bold mb-3">Customer</h5>
      <p><%= order.user.name %></p>
      <p><%= order.user.email %></p>
    </div>
  </div>

  <!-- DELIVERY ADDRESS -->
  <div class="col-md-6">
    <div class="card shadow-sm border-0 p-4 mb-4">
      <h5 class="fw-bold mb-3">Delivery Address</h5>

      <% if (order.shippingAddress && order.shippingAddress.fullName) { %>
      
        <p><strong>Name:</strong>
          <%= order.shippingAddress.fullName %>
        </p>
        <p><strong>Phone:</strong>
          <%= order.shippingAddress.phone %>
        </p>
      
        <p><strong>Address:</strong>
          <%= order.shippingAddress.addressLine1 %><br />
            <%= order.shippingAddress.addressLine2 || '' %>
        </p>
      
        <p>
          <%= order.shippingAddress.city %>,
            <%= order.shippingAddress.state %> -
              <%= order.shippingAddress.pincode %>
        </p>
      
        <% } else { %>
          <p class="text-muted">
            Shipping address not available for this order.
          </p>
          <% } %>
    </div>
  </div>

</div>
<br>
<!-- ORDER ITEMS -->
<div class="card shadow-sm border-0 p-4">
  <h5 class="fw-bold mb-3">Items</h5>

  <table class="table">
    <thead>
      <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody>
      <% order.items.forEach(item => { %>
        <tr>
          <% if(item.product){ %>
          <td><%= item.product.name %></td>
          <td><%= item.quantity %></td>
          <td>₹<%= item.price %></td>
          <% }else{ %>
            <td><span class="text-danger">Product removed</span></td>
          <td><%= item.quantity %></td>
          <td>₹<%= item.price %></td>
          <% } %>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
<br>
<!-- PAYMENT DETAILS -->
<div class="card shadow-sm border-0 p-4 mb-4">
  <h5 class="fw-bold mb-3">Payment Details</h5>

  <p>
    <strong>Payment Method:</strong>
    <%= order.paymentMethod || 'UPI' %>
  </p>

  <p>
    <strong>Payment Status:</strong>
    <span class="badge <%= order.paymentStatus === 'Paid' ? 'bg-success' : 'bg-warning' %>">
      <%= order.paymentStatus %>
    </span>
  </p>

  <% if (order.upiTransactionId) { %>
    <p>
      <strong>UPI Transaction ID:</strong>
      <%= order.upiTransactionId %>
    </p>
  <% } %>

  <% if (order.paymentProof) { %>
    <div class="mt-3">
      <strong>Payment Proof:</strong><br />

      <a
        href="<%= order.paymentProof %>"
        target="_blank"
      >
        <img
          src="<%= order.paymentProof %>"
          alt="Payment Proof"
          style="max-width: 260px; border: 1px solid #ddd; margin-top: 10px;"
        />
      </a>

      <p class="text-muted mt-2" style="font-size:14px;">
        Click image to view full size
      </p>
    </div>
  <% } else { %>
    <p class="text-muted">No payment proof uploaded yet.</p>
  <% } %>

  <% if (order.paymentStatus === 'Pending' && order.paymentProof) { %>
    <form
      action="/admin/orders/mark-paid/<%= order._id %>"
      method="POST"
      class="mt-4"
    >
      <button class="btn btn-success">
        Mark as Paid
      </button>
    </form>
  <% } %>
</div>
